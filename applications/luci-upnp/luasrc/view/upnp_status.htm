<script type="text/javascript"><![CDATA[


	function upnp_delete_fwd(idx) {
		var dlxhr = new XHR();

		dlxhr.get('<%=luci.dispatcher.build_url("admin", "services", "upnp", "delete")%>/' + idx, null,
			function(x)
			{
				var tb = document.getElementById('upnp_status_table');
				if (tb && (idx < tb.rows.length))
					tb.rows[0].parentNode.removeChild(tb.rows[idx]);
			}
		);
	}

	var stxhr = new XHR();
	var update_status = function() {
		stxhr.get('<%=luci.dispatcher.build_url("admin", "services", "upnp", "status")%>', null,
			function(x, st)
			{
				var tb = document.getElementById('upnp_status_table');
				if (st && tb)
				{
					/* clear all rows */
					while( tb.rows.length > 1 )
						tb.rows[1].parentNode.removeChild(tb.rows[1]);

					for( var i = 0; i < st.length; i++ )
					{
						var tr = document.createElement('tr');
							tr.className = 'cbi-section-table-row cbi-rowstyle-' + ((i % 2) + 1);

						tr.innerHTML = String.format(
							'<td class="cbi-section-table-cell">%s</td>' +
							'<td class="cbi-section-table-cell">%d</td>' +
							'<td class="cbi-section-table-cell">%s</td>' +
							'<td class="cbi-section-table-cell">%d</td>' +
							'<td class="cbi-section-table-cell">' +
								'<input class="cbi-input-remove" type="button" value="<%:Delete Redirect%>" onclick="upnp_delete_fwd(%d)" />' +
							'</td>',
								st[i].proto,
								st[i].extport,
								st[i].intaddr,
								st[i].intport,
								st[i].num
						);

						tb.rows[0].parentNode.appendChild(tr);
					}

					if( tb.rows.length == 1 )
					{
						var tr = document.createElement('tr');
							tr.className = 'cbi-section-table-row';
							tr.innerHTML = '<td colspan="5"><em><br /><%:There are no active redirects.%></em></td>';

						tb.rows[0].parentNode.appendChild(tr);
					}
				}

				window.setTimeout(update_status, 5000);
			}
		)
	};

	update_status();
]]></script>

<fieldset class="cbi-section">
	<legend><%:Active UPnP Redirects%></legend>
	<table class="cbi-section-table" id="upnp_status_table">
		<tr class="cbi-section-table-titles">
			<th class="cbi-section-table-cell"><%:Protocol%></th>
			<th class="cbi-section-table-cell"><%:External Port%></th>
			<th class="cbi-section-table-cell"><%:Client Address%></th>
			<th class="cbi-section-table-cell"><%:Client Port%></th>
			<th class="cbi-section-table-cell">&nbsp;</th>
		</tr>
		<tr class="cbi-section-table-row">
			<td colspan="5"><em><br /><%:Collecting data...%></em></td>
		</tr>
	</table>
</fieldset>
