<%#
LuCI - Lua Configuration Interface
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008 Jo-Philipp Wich <xm@leipzig.freifunk.net>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

$Id$

-%>
<%+header%>
<%-
local system, model, memtotal = luci.sys.sysinfo()

local uptime = luci.sys.uptime()
uptime = tonumber(uptime)

local utdays = math.floor(uptime / 86400)
uptime = uptime % 86400
local uthour = math.floor(uptime / 3600)
uptime = uptime % 3600
local utmins  = math.floor(uptime / 60)
local utsecs = uptime % 60

local iwconfig = luci.sys.wifi.getiwconfig()
-%>
<h1><%:a_i_i_hello%></h1>
<p><%:a_i_i_admin1%></p>
<p><%:a_i_i_admin2%><br />
<%:a_i_i_admin3%></p>
<p><%:a_i_i_admin6%></p>
<p><em><strong><a href="<%=controller%>/about"><%:a_i_i_team%></a></strong></em></p>
<br />
<hr />
<br />
<h2>Systemstatus</h2>
<table cellspacing="0" cellpadding="6" class="smalltext">
  <tr>
    <th><%:hostname%>:</th>
    <td><%=luci.sys.hostname()%></td>
  </tr>
  <tr>
    <th><%:system%>:</th>
    <td><%=system%></td>
  </tr>
  <tr>
    <th><%:m_i_processor%>:</th>
    <td><%=model%></td>
  </tr>
  <tr>
    <th><%:m_i_memory%>:</th>
    <td><%=string.format("%.2f", tonumber(memtotal) / 1024)%> MiB</td>
  </tr>
  <tr>
    <th><%:m_i_systemtime%>:</th>
    <td><%=os.date("%c")%></td>
  </tr>
  <tr>
    <th><%:m_i_uptime%>:</th>
    <td><%=string.format("%dd %d:%d:%.0f", utdays, uthour, utmins, utsecs)%></td>
  </tr>
</table>


<%- if luci.model.uci.get_statevalue("network", "lan", "up") == "1" then %>
<br />
<h2><%:m_n_local%></h2>
<table cellspacing="0" cellpadding="6" class="smalltext">
  <tr>
    <th><%:ipaddress%>:</th>
    <td><%=luci.model.uci.get_statevalue("network", "lan", "ipaddr")%></td>
  </tr>
  <tr>
    <th><%:netmask%>:</th>
    <td><%=luci.model.uci.get_statevalue("network", "lan", "netmask")%></td>
  </tr>
</table>
<%- end %>


<%- if luci.model.uci.get_statevalue("network", "lan", "up") == "1" then %>
<br />
<h2><%:m_n_inet%></h2>
<table cellspacing="0" cellpadding="6" class="smalltext">
  <tr>
    <th><%:ipaddress%>:</th>
    <td><%=luci.model.uci.get_statevalue("network", "wan", "ipaddr")%></td>
  </tr>
  <tr>
    <th><%:netmask%>:</th>
    <td><%=luci.model.uci.get_statevalue("network", "wan", "netmask")%></td>
  </tr>
</table>
<%- end %>

<%- if next(iwconfig) then %> 
<h2><%:wifi%></h2>
<br />
<table cellspacing="0" cellpadding="6" class="smalltext">
<tr>
<th><%:name%></th>
<th><%:protocol%></th>
<th><%:frequency%></th>
<th><%:power%></th>
<th><%:bitrate%></th>
<th><%:rts%></th>
<th><%:frag%></th>
<th><%:link%></th>
<th><%:signal%></th>
<th><%:noise%></th>
</tr>
<%for k, v in pairs(iwconfig) do
%>
<tr>
<td rowspan="2"><%=k%></td>
<td><%=v[1]%></td>
<td><%=v.Frequency%></td>
<td><%=v["Tx-Power"]%></td>
<td><%=v["Bit Rate"]%></td>
<td><%=v["RTS thr"]%></td>
<td><%=v["Fragment thr"]%></td>
<td><%=v["Link Quality"]%></td>
<td><%=v["Signal level"]%></td>
<td><%=v["Noise level"]%></td>
</tr>
<tr>
<td colspan="4"><strong>ESSID: </strong><%=v.ESSID%></td>
<td colspan="5"><strong>BSSID: </strong><%=(v.Cell or v["Access Point"])%></td>
</tr>
<%end%>
</table>
<%-end%>
<%+footer%>
